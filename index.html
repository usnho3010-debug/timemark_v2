<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Timemark Style Pro</title>
<style>
body{font-family:Arial;background:#f4f4f4;padding:10px}
input,button,label{width:100%;padding:6px;margin:4px 0;font-size:14px}
canvas{max-width:100%;margin-top:10px;border:1px solid #ccc}
.controls{background:#fff;padding:10px;border-radius:8px}
/* ===== BACKGROUND T·∫æT ===== */
body{
  margin:0;
  background: linear-gradient(135deg,#a80000,#ff6a00,#ffd54f);
  min-height:100vh;
}

/* n·ªÅn m·ªù */
.bg{
  position:fixed;
  inset:0;
  backdrop-filter: blur(6px);
  z-index:0;
}

/* ===== APP ===== */
.app{
  position:relative;
  z-index:2;
  max-width:520px;
  margin:auto;
}

/* ===== HEADER ===== */
.header{
  text-align:center;
  color:#fff;
  margin-bottom:10px;
}
.header h2{
  margin:10px 0 4px;
}
.tet{
  font-size:14px;
  opacity:.9;
}

/* ===== CARD ===== */
.controls{
  background:rgba(255,255,255,0.18);
  backdrop-filter:blur(14px);
  border-radius:18px;
  box-shadow:0 20px 40px rgba(0,0,0,.25);
  color:#fff;
}

/* input */
.controls input,
.controls button{
  border-radius:12px;
}

/* canvas */
canvas{
  background:#000;
  border-radius:18px;
  box-shadow:0 15px 35px rgba(0,0,0,.4);
}

/* ===== HOA R∆†I ===== */
.petals{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:1;
}
@keyframes fall{
  to{transform:translateY(120vh)}
}
@keyframes sway{
  0%{margin-left:0}
  50%{margin-left:30px}
  100%{margin-left:0}
}

</style>
</head>

<body>
<div class="bg"></div>
<div class="petals" id="petals"></div>

<div class="app">
  <header class="header">
    <h2>üìç Timemark ver2 üìç</h2>
    <p class="tet">üå∏ Ch√∫c m·ª´ng nƒÉm m·ªõi ‚Äì An khang ¬∑ Th·ªãnh v∆∞·ª£ng üå∏</p>
  </header>
<div id="toast" style="
  position:fixed;
  top:20px;
  left:50%;
  transform:translateX(-50%) translateY(-10px);
  background:rgba(0,0,0,0.78);
  color:#fff;
  padding:14px 18px 12px;
  border-radius:12px;
  font-size:14px;
  line-height:1.45;
  z-index:9999;
  opacity:0;
  transition:opacity .4s, transform .4s;
  pointer-events:none;
  max-width:90%;
  box-shadow:0 8px 30px rgba(0,0,0,.35);
">
  <div style="margin-bottom:10px">
    <b>üëã Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi Timemark</b><br>
    ‚Ä¢ B1: Th√™m ·∫£nh check-in V√† ·∫£nh logo Cty (n·∫øu c·∫ßn)<br>
    ‚Ä¢ B2: B·∫•m l·∫•y ng√†y gi·ªù ( c√≥ th·ªÉ nh·∫≠p th·ªß c√¥ng)<br>
    ‚Ä¢ B3: Nh·∫•n <b>‚ÄúT·∫°o watermark‚Äù</b> ƒë·ªÉ t·∫°o ·∫£nh<br>
    <span style="opacity:.7">‚ùå‚ùå App do IT ·∫•n ƒë·ªô l√†m, ai khai ra b·∫Øn b·ªè‚ùå‚ùå</span>
  </div>

  <div style="text-align:right">
    <button onclick="hideToast()" style="
      background:#FFC107;
      color:#000;
      border:none;
      padding:6px 14px;
      border-radius:8px;
      font-weight:600;
      cursor:pointer;
    ">
      OK
    </button>
  </div>
</div>


<div class="controls">
<label>Th√™m ·∫£nh check-in</label>
<input type="file" id="imageInput" accept="image/*">

<label>Th√™m ·∫£nh logo</label>
<input type="file" id="logoInput" accept="image/*">

<label>Gi·ªù</label>
<input type="text" id="time">

<label>Ng√†y</label>
<input type="text" id="date">

<label>Th·ª©</label>
<input type="text" id="weekday">

<label>ƒê·ªãa ch·ªâ (X√£, Huy·ªán, T·ªânh)</label>
<input type="text" id="address">

<hr>
<label><input type="checkbox" id="toggleLogo" checked> Hi·ªÉn th·ªã logo</label>
<label><input type="checkbox" id="toggleTime" checked> Hi·ªÉn th·ªã gi·ªù / ng√†y</label>
<label><input type="checkbox" id="toggleAddress" checked> Hi·ªÉn th·ªã ƒë·ªãa ch·ªâ</label>
<label><input type="checkbox" id="toggleBrand" checked> Hi·ªÉn th·ªã Timemark</label>
<label><input type="checkbox" id="toggleVertical" checked> Hi·ªÉn th·ªã watermark d·ªçc</label>

<button onclick="setNow()">‚è± L·∫•y gi·ªù hi·ªán t·∫°i</button>
<button onclick="draw()">üñä T·∫°o watermark</button>
<button onclick="download()">‚¨áÔ∏è T·∫£i ·∫£nh</button>
</div>

<canvas id="c"></canvas>


<script>
const c = document.getElementById("c");
const ctx = c.getContext("2d");

function isOn(id){
  const el = document.getElementById(id);
  return el ? el.checked : true;
}

let img = new Image();
let logo = new Image();

function fs(p){
  return Math.round(Math.min(c.width,c.height)*p);
}

function generateCode(len=12){
 const s="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
 return Array.from({length:len},()=>s[Math.random()*s.length|0]).join("");
}

function drawRoundedImage(ctx, img, x, y, w, h, r){
  ctx.save();
  ctx.beginPath();
  ctx.moveTo(x + r, y);
  ctx.lineTo(x + w - r, y);
  ctx.quadraticCurveTo(x + w, y, x + w, y + r);
  ctx.lineTo(x + w, y + h - r);
  ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
  ctx.lineTo(x + r, y + h);
  ctx.quadraticCurveTo(x, y + h, x, y + h - r);
  ctx.lineTo(x, y + r);
  ctx.quadraticCurveTo(x, y, x + r, y);
  ctx.closePath();
  ctx.clip();
  ctx.drawImage(img, x, y, w, h);
  ctx.restore();
}

imageInput.onchange = e=>{
 const r=new FileReader();
 r.onload=()=>img.src=r.result;
 r.readAsDataURL(e.target.files[0]);
};

logoInput.onchange = e=>{
 const r=new FileReader();
 r.onload=()=>logo.src=r.result;
 r.readAsDataURL(e.target.files[0]);
};

img.onload=()=>{
 c.width=img.width;
 c.height=img.height;
 ctx.drawImage(img,0,0);
};

function setNow(){
 const d=new Date();

 time.value=d.toLocaleTimeString("vi-VN",{hour:'2-digit',minute:'2-digit'});

 const day=String(d.getDate()).padStart(2,'0');
 const month=String(d.getMonth()+1).padStart(2,'0');
 const year=d.getFullYear();
 date.value=`${day}/${month}/${year}`;

 weekday.value=d.toLocaleDateString("vi-VN",{weekday:'long'});
}

function draw(){
 if(!img.src) return alert("Ch∆∞a ch·ªçn ·∫£nh");
 ctx.drawImage(img,0,0);

 const pad=fs(0.04);

 /* ===== WATERMARK D·ªåC ===== */
 if(isOn("toggleVertical")){
  ctx.save();
  ctx.translate(c.width-fs(0.008),c.height/2);
  ctx.rotate(-Math.PI/2);
  ctx.fillStyle="rgba(255,255,255,0.9)";
  ctx.font=`${fs(0.018)}px Arial`;
  ctx.textAlign="center";
  ctx.fillText(`${generateCode()}  Timemark Verified`,0,0);
  ctx.restore();
 }

 /* ===== BRAND PH·∫¢I D∆Ø·ªöI ===== */
 if(isOn("toggleBrand")){
  let yBrand=c.height-pad;
  ctx.textAlign="right";
  ctx.font=`bold ${fs(0.028)}px Arial`;

  ctx.fillStyle="#FFFFFF";
  ctx.fillText("mark",c.width-pad,yBrand);
  const wMark=ctx.measureText("mark").width;

  ctx.fillStyle="#FFC107";
  ctx.fillText("Time",c.width-pad-wMark,yBrand);

  ctx.font=`${fs(0.018)}px Arial`;
  ctx.fillStyle="rgba(255,255,255,0.5)";
  ctx.fillText("100% Ch√¢n th·ª±c",c.width-pad,yBrand+fs(0.03));
 }

 /* ===== C·ª§M TR√ÅI D∆Ø·ªöI ===== */
 ctx.textAlign="left";
 let leftX=pad;
 let y=c.height-pad-fs(0.09);

 /* LOGO */
 if(logo.src && isOn("toggleLogo")){
  const lh=fs(0.085);
  const ratio=logo.width/logo.height;
  drawRoundedImage(ctx,logo,leftX,y-lh-fs(0.02),lh*ratio,lh,fs(0.012));
  y+=fs(0.02);
 }

 /* GI·ªú | NG√ÄY | TH·ª® */
 let lineX=leftX;
 if(isOn("toggleTime")){
  ctx.font=`500 ${fs(0.045)}px "Inter","Helvetica Neue",Arial,sans-serif`;
  ctx.fillStyle="#FFFFFF";
  ctx.fillText(time.value,leftX,y+fs(0.015));

  const timeW=ctx.measureText(time.value).width;
  lineX=leftX+timeW+fs(0.02);

  ctx.strokeStyle="#FFFFFF";
  ctx.lineWidth=fs(0.004);
  ctx.beginPath();
  ctx.moveTo(lineX,y-fs(0.028));
  ctx.lineTo(lineX,y+fs(0.028));
  ctx.stroke();

  ctx.font=`${fs(0.03)}px "Inter","Helvetica Neue",Arial,sans-serif`;
  ctx.fillText(date.value,lineX+fs(0.015),y-fs(0.01));
  ctx.fillText(weekday.value,lineX+fs(0.015),y+fs(0.03));
 }

 /* ƒê·ªäA CH·ªà */
 if(isOn("toggleAddress")){
  y+=fs(0.065);
  ctx.font=`${fs(0.028)}px "Inter","Helvetica Neue",Arial,sans-serif`;
  ctx.fillStyle="rgba(255,255,255,0.9)";
  ctx.fillText(address.value,leftX,y);
 }
}

/* ===== DOWNLOAD ===== */
function isIOS(){
 return /iPhone|iPad|iPod/i.test(navigator.userAgent);
}

function download(){
 if(!img.src) return alert("Ch∆∞a c√≥ ·∫£nh ƒë·ªÉ t·∫£i");
 const d=c.toDataURL("image/png");
 if(isIOS()){
  const w=window.open();
  w.document.write(`<img src="${d}" style="width:100%"><p>Nh·∫•n gi·ªØ ·∫£nh ‚Üí L∆∞u</p>`);
 }else{
  const a=document.createElement("a");
  a.href=d;a.download="timemark.png";a.click();
 }
}
// Hi·ªán toast sau khi trang load xong (an to√†n)
setTimeout(() => {
  if(typeof showToast === "function"){
    showToast();
  }
}, 300);

/* ===== HOA R∆†I NH·∫∏ ===== */
const flowers=["üå∏","üåº","üå∫"];
const box=document.getElementById("petals");
for(let i=0;i<25;i++){
  const p=document.createElement("div");
  p.innerText=flowers[Math.floor(Math.random()*flowers.length)];
  p.style.position="absolute";
  p.style.left=Math.random()*100+"vw";
  p.style.top="-10%";
  p.style.fontSize=(14+Math.random()*18)+"px";
  p.style.opacity=0.85;
  p.style.animation=
    `fall ${10+Math.random()*10}s linear infinite,
     sway ${3+Math.random()*4}s ease-in-out infinite`;
  box.appendChild(p);
}
/* ===== TOAST WELCOME ===== */
window.addEventListener("load", ()=>{
  const t = document.getElementById("toast");
  if(!t) return;

  t.style.opacity = "1";
  t.style.transform = "translateX(-50%) translateY(10px)";

  setTimeout(()=>{
    t.style.opacity = "0";
    t.style.transform = "translateX(-50%) translateY(-10px)";
  }, 3500000);
});
function showToast(){
  const t = document.getElementById("toast");
  t.style.opacity = "1";
  t.style.transform = "translateX(-50%) translateY(0)";
  t.style.pointerEvents = "auto";
}

function hideToast(){
  const t = document.getElementById("toast");
  t.style.opacity = "0";
  t.style.transform = "translateX(-50%) translateY(-10px)";
  t.style.pointerEvents = "none";
}

</script>
</body>
</html>
